@model Dswi_Proyecto_Topico.Models.Entitties.Cita

@{
    ViewData["Title"] = "Detalle Cita";
    var estadoFiltro = ViewBag.EstadoFiltro as string;
}

<h3 class="mb-3">Detalle de Cita #@Model.CitaId</h3>


<div class="card shadow-sm mb-3">
    <div class="card-body">
        <div class="row g-3">
            <div class="col-md-6">
                <p><strong>Alumno:</strong> @Model.Alumno?.NombreCompleto</p>
                <p><strong>Código:</strong> @Model.Alumno?.Codigo</p>
                <p><strong>DNI:</strong> @Model.Alumno?.DNI</p>
            </div>
            <div class="col-md-6">
                <p><strong>Fecha:</strong> @Model.FechaCita.ToString("dd/MM/yyyy HH:mm")</p>
                <p><strong>Tipo:</strong> @Model.TipoCita</p>
                <p>
                    <strong>Estado actual:</strong>
                    @if (Model.EstadoCita == "Pendiente")
                    {
                        <span class="badge bg-warning"><i class="fas fa-clock"></i> Pendiente</span>
                    }
                    else if (Model.EstadoCita == "Atendida")
                    {
                        <span class="badge bg-success"><i class="fas fa-check-circle"></i> Atendida</span>
                    }
                    else
                    {
                        <span class="badge bg-danger"><i class="fas fa-times-circle"></i> Cancelada</span>
                    }
                </p>
            </div>
        </div>

        

        <form asp-action="ActualizarEstado" method="post" class="mt-3">
            @Html.AntiForgeryToken()
            <input type="hidden" name="id" value="@Model.CitaId" />

            <div class="mb-3">
                <label class="form-label"><strong>Cambiar Estado de Cita: </strong></label>
                <select asp-for="EstadoCita" class="form-select">
                    <option value="Pendiente">Pendiente</option>
                    <option value="Atendida">Atendida</option>
                    <option value="Cancelada">Cancelada</option>
                </select>
            </div>


            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-save"></i> Guardar
                </button>
                <a asp-action="Citas" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left"></i> Volver al listado
                </a>
            </div>
        </form>
    </div>
</div>

@if (TempData["MensajeExito"] != null)
{
    <div class="modal fade" id="modalExito" tabindex="-1" aria-labelledby="modalExitoLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content shadow">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="modalExitoLabel">
                        <i class="bi bi-check-circle me-2"></i> Confirmación
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body text-center">
                    <p class="fs-5 mb-0">@TempData["MensajeExito"]</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-success" data-bs-dismiss="modal">Aceptar</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var modalExito = new bootstrap.Modal(document.getElementById('modalExito'));
            modalExito.show();
        });
    </script>
}



